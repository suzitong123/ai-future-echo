<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æœªæ¥å›éŸ³</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 600px;
            width: 100%;
        }
        h1 { text-align: center; margin-bottom: 10px; color: #333; }
        .subtitle { text-align: center; color: #666; margin-bottom: 25px; }
        textarea {
            width: 100%;
            height: 120px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            resize: vertical;
        }
        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
        }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .result { margin-top: 25px; padding-top: 25px; border-top: 1px solid #eee; }
        .loading { text-align: center; padding: 20px; }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ•’ AI æœªæ¥å›éŸ³</h1>
        <p class="subtitle">å†™ä¸‹æ­¤åˆ»çš„å¿ƒå£°ï¼Œé‡è§æœªæ¥çš„è‡ªå·±</p>
        
        <textarea id="userInput" placeholder="åˆ†äº«ä½ æ­¤åˆ»çš„æƒ³æ³•ã€æ¢¦æƒ³æˆ–å›°æƒ‘..."></textarea>
        <button id="generateBtn" onclick="generateFutureLetter()">âœ¨ ç”Ÿæˆæœªæ¥å›éŸ³</button>
        
        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>AIæ­£åœ¨æ„æ€æ¥è‡ªæœªæ¥çš„ä¿¡ä»¶...</p>
        </div>
        
        <div id="result" class="result" style="display: none;">
            <h3>ğŸ’Œ æ¥è‡ªæœªæ¥çš„ä¿¡</h3>
            <div id="letterContent" style="background: #f9f9f9; padding: 15px; border-radius: 10px; margin: 15px 0; line-height: 1.6;"></div>
            <button onclick="speakLetter()">ğŸ”Š æœ—è¯»ä¿¡ä»¶</button>
        </div>
    </div>

    <script>
        // è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒå¹¶è®¾ç½®APIç«¯ç‚¹
        const isVercel = window.location.hostname.includes('vercel.app');
        const isLocal = window.location.hostname.includes('localhost') || 
                       window.location.hostname.includes('127.0.0.1');
        
        const API_BASE = isVercel ? window.location.origin : 
                        isLocal ? 'http://localhost:3000' : 
                        window.location.origin;

        console.log('è¿è¡Œç¯å¢ƒ:', { isVercel, isLocal, API_BASE });

        async function generateFutureLetter() {
            const input = document.getElementById('userInput').value.trim();
            if (!input) {
                alert('è¯·å…ˆå†™ä¸‹ä¸€äº›å†…å®¹ï¼');
                return;
            }

            const btn = document.getElementById('generateBtn');
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');

            btn.disabled = true;
            loading.style.display = 'block';
            result.style.display = 'none';

            try {
                // å°è¯•è°ƒç”¨åç«¯API
                const response = await fetch(`${API_BASE}/api/generate-capsule`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ input })
                });

                if (response.ok) {
                    const data = await response.json();
                    showResult(data.letter);
                } else {
                    throw new Error('APIè¯·æ±‚å¤±è´¥');
                }
            } catch (error) {
                console.log('ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:', error.message);
                // æ¨¡æ‹Ÿæ•°æ®ä½œä¸ºå¤‡é€‰
                const mockLetter = generateMockLetter(input);
                showResult(mockLetter);
            } finally {
                btn.disabled = false;
                loading.style.display = 'none';
            }
        }

        function showResult(letter) {
            document.getElementById('letterContent').textContent = letter;
            document.getElementById('result').style.display = 'block';
            window.currentLetter = letter;
        }

        function generateMockLetter(input) {
            const templates = [
                `äº²çˆ±çš„ç°åœ¨çš„æˆ‘ï¼Œ\n\næˆ‘æ˜¯5å¹´åçš„ä½ ã€‚çœ‹åˆ°ä½ æ­¤åˆ»çš„æƒ³æ³•ï¼š"${input}"ï¼Œæˆ‘æƒ³å‘Šè¯‰ä½ ï¼Œç”Ÿå‘½ä¸­çš„æ¯ä¸€ä¸ªé˜¶æ®µéƒ½æœ‰å…¶ç‹¬ç‰¹çš„æ„ä¹‰ã€‚é‚£äº›è®©ä½ æ€è€ƒçš„æ—¶åˆ»ï¼Œé‚£äº›è®©ä½ æˆé•¿çš„ç»å†ï¼Œéƒ½åœ¨æ‚„æ‚„å¡‘é€ ç€æ›´ç¾å¥½çš„ä½ ã€‚\n\nç›¸ä¿¡æ—¶é—´çš„é­”åŠ›ï¼Œä¿æŒå¿ƒçµçš„å¼€æ”¾ï¼Œæœªæ¥ä¼šä»¥ä½ æ„æƒ³ä¸åˆ°çš„æ–¹å¼å±•å¼€ã€‚è®°ä½ï¼Œæœ€ç¾å¥½çš„é£æ™¯å¾€å¾€åœ¨è·¯ä¸Šï¼Œè€Œä¸åªæ˜¯åœ¨ç›®çš„åœ°ã€‚\n\nâ€”â€” æ°¸è¿œç›¸ä¿¡ä½ çš„æœªæ¥æˆ‘`,

                `å—¨ï¼ç°åœ¨çš„ä½ ï¼Œ\n\næˆ‘æ˜¯æœªæ¥ç‰ˆæœ¬çš„ä½ ï¼å¬è¯´ä½ æ­£åœ¨æ€è€ƒå…³äº"${input}"ï¼Œè¿™çœŸæ˜¯å¤ªæ£’äº†ï¼æ¯ä¸€ä¸ªçœŸè¯šçš„æ€è€ƒéƒ½æ˜¯é€šå‘æ›´å¥½æœªæ¥çš„é’¥åŒ™ã€‚\n\næƒ³è±¡ä¸€ä¸‹ï¼Œ3å¹´åçš„ä½ åœ¨å›å¤´çœ‹æ—¶ï¼Œä¼šæ·±æ·±æ„Ÿæ¿€ç°åœ¨è¿™ä¸ªå‹‡æ•¢æ¢ç´¢çš„è‡ªå·±ã€‚ä¿æŒå¥½å¥‡å¿ƒï¼Œç»§ç»­å‰è¡Œï¼Œä½ æ‹¥æœ‰çš„æ½œåŠ›è¶…ä¹ä½ çš„æƒ³è±¡ï¼\n\nâœ¨ ä¸ä½ åŒè¡Œçš„æœªæ¥æˆ‘`
            ];
            return templates[Math.floor(Math.random() * templates.length)];
        }

        function speakLetter() {
            if (!window.currentLetter) return;
            
            if ('speechSynthesis' in window) {
                const speech = new SpeechSynthesisUtterance(window.currentLetter);
                speech.lang = 'zh-CN';
                speech.rate = 0.9;
                window.speechSynthesis.speak(speech);
            } else {
                alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³æœ—è¯»åŠŸèƒ½');
            }
        }

        // NFCæ£€æµ‹ - å¦‚æœæ˜¯é€šè¿‡NFCè®¿é—®ï¼Œæ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
        if (window.location.search.includes('nfc=true') || 
            document.referrer.includes('nfc')) {
            console.log('ğŸ“± NFCè®¿é—®æ£€æµ‹');
        }
    </script>
</body>
</html>